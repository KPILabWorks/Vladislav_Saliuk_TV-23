import numpy as np
import matplotlib.pyplot as plt
from scipy.integrate import odeint

# Параметри моделі
D0 = 1000  # Базовий попит, МВт
S0 = 800   # Базова пропозиція, МВт
a = 10     # Чутливість попиту до ціни
b = 5      # Чутливість пропозиції до ціни
k = 0.1    # Швидкість адаптації ціни
P0 = 50    # Початкова ціна, грн/МВт·год
m = 20     # Темп зростання попиту, МВт/рік
n = 10     # Темп зростання пропозиції, МВт/рік

# Часовий діапазон (5 років)
t = np.linspace(0, 5, 100)

# 1. Динамічна модель: диференціальне рівняння
def dP_dt(P, t):
    D = D0 - a * P
    S = S0 + b * P
    return k * (D - S)

# Чисельне розв’язання диференціального рівняння
P_dynamic = odeint(dP_dt, P0, t)

# Рівноважна ціна для динамічної моделі
P_e = (D0 - S0) / (a + b)

# 2. Трендова екстраполяція
P_trend = (D0 + m * t - S0) / (a + b)

# Аналітичний розв’язок для динамічної моделі (для перевірки)
P_analytic = P_e + (P0 - P_e) * np.exp(-k * (a + b) * t)

# Візуалізація
plt.figure(figsize=(10, 6))
plt.plot(t, P_dynamic, label='Динамічна модель (чисельне)', color='blue')
plt.plot(t, P_analytic, '--', label='Динамічна модель (аналітичне)', color='cyan')
plt.plot(t, P_trend, label='Трендова екстраполяція', color='red')
plt.axhline(y=P_e, color='green', linestyle='--', label=f'Рівноважна ціна = {P_e:.2f}')
plt.xlabel('Час (роки)')
plt.ylabel('Ціна (грн/МВт·год)')
plt.title('Порівняння моделей попиту та пропозиції електроенергії')
plt.legend()
plt.grid(True)
plt.show()

# Виведення результатів для t = 5 років
print(f"Динамічна модель (чисельне) при t=5: {P_dynamic[-1][0]:.2f} грн/МВт·год")
print(f"Динамічна модель (аналітичне) при t=5: {P_analytic[-1]:.2f} грн/МВт·год")
print(f"Трендова екстраполяція при t=5: {P_trend[-1]:.2f} грн/МВт·год")
